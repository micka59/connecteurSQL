{
"name": "Mise a jour des flux",

"description" : "connecteur pour la mise a jour des flux. Publication dans canopsis",

"data_output": {

        "type": "json",

        "params": {"q1":"tbsvg"},

        "encode" : "utf-8"

},

"data_sources": [

                {

                        "type": "Database",

                        "instance": "P1SUFGL1",

                        "list_queries": [

                                {

					"query" : "SELECT   idstk,  A.*, UNIX_TIMESTAMP(dtsup) as timestamp from os_stk_sea_svt A join os_stk_sea_notif B on A.idseastk=B.idseastk  where okday='O' and dtsync='1753-01-01' and idstk=1",
                                        "name":"q1",

                                        "description":false,
					"mapping": {
						"fields_renaming": {
							"resource": ["nmressource", false, false],
							"component": ["nmcomposant", false, false],
							"metric.nbflux_in.value": ["nbflx_in", false, false],
							"metric.nbflux_out.value": ["nbflx_out", false, false],
							"metric.nbflux_intra.value": ["nbflx_intra", false, false],
							"metric.refflux_in.value": ["nbrefflx_in", false, false],
							"metric.refflux_out.value": ["nbrefflx_out", true, false],
							"metric.refflux_intra.value": ["nbrefflx_intra", true, false],
							"metric.dureeflux_entrant.value": ["duree_flx_in", true, false],
							"metric.dureeflux_sortant.value": ["duree_flx_out", true, false],
							"metric.dureeflux_intra.value": ["duree_flx_intra", true, false],
							"metric.dureetrtflux_entrant.value": ["duree_trf_flx_in", true, false],
							"metric.dureetrtflux_sortant.value": ["duree_trf_flx_out", true, false],
							"metric.dureetrtflux_intra.value": ["duree_trf_flx_intra", true, false],
							"metric.dureemaxtrtflux_entrant.value": ["duree_trf_flx_max_in", true, false],
							"metric.dureemaxtrtflux_sortant.value": ["duree_trf_flx_max_out", true, false],
							"metric.dureemaxtrtflux_intra.value": ["duree_trf_flx_max_intra", true, false],
							"metric.nbfic_entrant.value":["nbfic_in", true,false],
							"metric.nbfic_sortant.value":["nbfic_out", true, false],
							"metric.nbfic__intra.value": ["nbfic_intra", true, false],
							"metric.nberrflux_entrant.value": ["nbflxerr_in", true, false],
							"metric.nberrflux_sortant.value": ["nbflxerr_out", true, false],
							"metric.nberrflux_intra.value": ["nbflxerr_intra", true, false],
							"metric.nbtrtok_entrant.value": ["nbtrtok_in", true, false],
							"metric.nbtrtok_sortant.value": ["nbtrtok_out", true, false],
							"metric.nbtrtok__intra.value": ["nbtrtok_intra", true, false],
							"metric.nbtrtnok_entrant.value": ["nbtrtnok_in", true, false],
							"metric.nbtrtnok_sortant.value": ["nbtrtnok_out", true, false],
							"metric.nbtrtnok__intra.value": ["nbtrtnok_intra", true, false],
							"metric.nbtrtflux_retry.value": ["nbtrfflx_retry_out", true, false],
							"metric.nbtrtflux_block.value": ["nbtrfflx_block_out", true, false]
						},
						"records_constants": {
							"connector": "SQLConnector",
							"connector_name": "flux_sea",
							"event_type": "check",
							"source_type": "component",
							"metric.nbflux_in.metric": "nbflux_in",
							"metric.nbflux_out.metric": "nbflux_out",
							"metric.nbflux_intra.metric": "nbflux_intra",
							"metric.refflux_in.metric": "refflux_in",
							"metric.refflux_out.metric": "refflux_out",
							"metric.refflux_intra.metric": "refflux_intra",
							"metric.dureeflux_entrant.metric": "dureeflux_entrant",
							"metric.dureeflux_sortant.metric": "dureeflux_sortant",
							"metric.dureeflux_intra.metric": "dureeflux_intra",
							"metric.dureetrtflux_entrant.metric": "dureetrtflux_entrant",
							"metric.dureetrtflux_sortant.metric": "dureetrtflux_sortant",
							"metric.dureetrtflux_intra.metric": "dureetrtflux_intra",
							"metric.dureemaxtrtflux_entrant.metric": "dureemaxtrtflux_entrant",
							"metric.dureemaxtrtflux_sortant.metric": "dureemaxtrtflux_sortant",
							"metric.dureemaxtrtflux_intra.metric": "dureemaxtrtflux_intra",
							"metric.nbfic_entrant.metric":"nbfic_entrant",
							"metric.nbfic_sortant.metric":"nbfic_sortant",
							"metric.nbfic__intra.metric": "nbfic__intra",
							"metric.nberrflux_entrant.metric": "nberrflux_entrant",
							"metric.nberrflux_sortant.metric": "nberrflux_sortant",
							"metric.nberrflux_intra.metric": "nberrflux_intra",
							"metric.nbtrtok_entrant.metric": "nbtrtok_entrant",
							"metric.nbtrtok_sortant.metric": "nbtrtok_sortant",
							"metric.nbtrtok__intra.metric": "nbtrtok__intra",
							"metric.nbtrtnok_entrant.metric": "nbtrtnok_entrant",
							"metric.nbtrtnok_sortant.metric": "nbtrtnok_sortant",
							"metric.nbtrtnok__intra.metric": "nbtrtnok__intra",
							"metric.nbtrtflux_retry_sortant.metric": "nbtrtflux_retry_sortant",
							"metric.nbtrtflux_block_sortant.metric": "nbtrtflux_block_sortant"
						}
					}

                                }

                        ]

                }

        ],
"post_treatments" : [ 
	{ "publishCanopsis.publishInCanopsis": { "amqp_host":"slxv0004"} },
	{ "publishCanopsis.updateTable": {
		"instance": "P1SUFGL1",
		"table": "os_stk_sea_notif",
		"fieldid": "idseastk",
		"idstk": 1
	} } ] 
}


